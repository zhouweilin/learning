<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>mlib-test</title>
    <link rel="stylesheet" href="./css/animate.min.css">
    <style>
        *{padding:0;margin:0;}
        html{height:100%;}
        body{height:100%;}
        .ajax{margin:100px auto;width:300px;}
    </style>  
<body> 
    <div class="ajax">
     <form action="">
        <dl>
          <dt>表单</dt>
          <dd><input type="text" name="name" placeholder="请输入您的姓名"></dd>
          <dd><input type="text" name="cell"placeholder="请输入您的手机号码"></dd>
          <dd><input type="text" placeholder="请输入其他信息"></dd>
          <dd><input type="radio" name="agend">男<input type="radio" name="agend">女</dd>
          <dd><input type="checkbox">音乐 <input type="checkbox">运动</dd>
          <input class="submit" type="submit">
        </dl>
      </form>
    </div>

    <script type="text/javascript" src="./js/jquery-1.12.js"></script>
    <script type="text/javascript" src="./js/plugins/dev/jquery.validate.js"></script>
    <script type="text/javascript" src="./js/mlib.js"></script>
    <script>

    (function(factory){
        if (typeof define === 'function' && define.amd) {

          // AMD. Register as an anonymous module.
          define(['jquery'], function ($) {
            return factory($);
          });
        } else if (typeof module === 'object' && typeof module.exports === 'object') {
          // Node-like environment
          module.exports = factory(require('jquery'));
        } else {

          // Browser global
          factory(window.jQuery);
        }

    }(function($){

        function validSubmit(param){
          var self = validSubmit;

          self.form = this;
          
          validSubmit.param = param;
          validSubmit.init();

          return validSubmit;
        }

        $.extend(validSubmit, {
          init: function(){
            this.getInputer();
            console.log('begin');
            this.submit();
          },

          getInputer: function(){
            var self = this;

            $.each(this.param.rules, function(key, val){
               $.extend(val, {
                  inputer: self.form.find('[name='+ key +']'),
                  info: false
               });

               self.focus.call(self, val);
            });
          },

          focus: function(val){
            var self = this;
            val.inputer.on('focus', function(){
             
              if(val.info && ('infoEle' in val)){ 
                 console.log(this);

                  val.infoEle.remove(); 
                  val.info = false;

                  delete val.infoEle;
              }
            });
          },

          submit: function(){
            var submit = this.submitBtn = this.form.find('.submit'),
                nodeName = submit.get(0).nodeName.toLowerCase(),
                self = this;

            submit.on('click', function(e){
              if(nodeName == 'input' || nodeName == 'a' || nodeName == 'button') e.preventDefault();
              self.valid.call(self);

              if($.isPlainObject(self.param.ajax)) $.ajax(self.param.ajax);
            });

          },

          valid: function(){
            var rules = this.param.rules,
                self = this;
           
            $.each(rules, function(key, val){
               if(val.info){return;}
               var ele = self.form.find('[name=' + key +']');
               self.info(ele, key, val);
               val.info = true;
            });

          },

          info: function(after, key, val){
            var ele = $('<b class="input-error '+ key +'-msg"><i>'+ val.message +'</i></b>');
            ele.insertAfter(after);
            val.infoEle = ele;
          }
        });

        $.fn.validSubmit = validSubmit;
      
    }));


    $(function(){

      // var a = $('.ajax').validSubmit({
      //   rules: {
      //     name: {
      //       focus: true,
      //       message: 'hi'
      //     },
      //     cell: {
      //       required: true,
      //       message: 'hello'
      //     }
      //   }
      // });
     
     
      var str = '??kissy/k/1.4.14/seed-min.js,mui/seed/1.4.8/seed.js,mui/globalmodule/3.0.59/seed.js,mui/btscfg-g/3.…:71 GET https://localhost.wwbizsrv.alibaba.com:4813/?_ksTS=1467361928020_973&callback=jsonp974;_ksTS=o1234;te_ksTS=o1123;';

      // console.log(str.match(/(?=;)(_ksTS=o[\d]{4})/g));

      var f = '99999999999'.replace(/\d{1,3}(?=(\d{3})+$)/g, '$&,');
      console.log(f);

      // console.log('123123211312.333333'.replace(/(?=(?!^)(?:\d{3})+(?:\.|$))(\d{3}(\.\d+$)?)/g, ',$1'));



     
    });

   
    </script>
</body>
</html>